<html>
<head>
<style type="text/css">
	body {font-family: Arial, Helvetica, sans-serif;}
input[type=text], select, textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    margin-top: 6px;
    margin-bottom: 16px;
    resize: vertical;
}
input[type=submit] {
    background-color: #4CAF50;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
input[type=submit]:hover {
    background-color: #45a049;
}
.container {
    border-radius: 5px;
    background-color: #f2f2f2;
    padding: 20px;
}
</style>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script type="text/javascript">
var thisURL = window.location.href;
var thisauthCode;
var accessTok;
console.log("Here");
if(thisURL.includes("code"))
{
	thisauthCode = thisURL.split("code=").pop();
        getAuthCode(thisauthCode);
	//console.log("Access Token"+accessTok);
}

function getAuthCode(code){
	 var newcd = code.replace("%3D%3D","==");
	console.log("CODEEEEE   "+code);
          var data = "grant_type=authorization_code&code="+newcd+"&client_id=3MVG9Y6d_Btp4xp6IO8doiQawYj4FhisKiBtMF6fhsDCkAdeMTfSy_h24E0jiJue3KqlhpVD5esusvOcrWbPv&client_secret=6634268264639020618&redirect_uri=https://shaileshjyotigit.github.io/testNewSfRestTest/SalesforceJQueryRESTCalls.html";
	console.log("Data Going "+data);
	var athcode;
      var xhr = new XMLHttpRequest();
	//xhr.withCredentials = true;
      xhr.addEventListener("readystatechange", function () {
        if (this.readyState === 4 && this.status == 200) {
		console.log("ReturnedJSON  "+xhr.responseText);
        accessTok  = jQuery.parseJSON(this.responseText).access_token;
		console.log(athcode);
		//return athcode;
          
        }
      });

      xhr.open("POST", "https://test.salesforce.com/services/oauth2/token");
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	xhr.setRequestHeader("Accept", "application/json");
      xhr.send(data);
      
}
function getBase64(file) {
   var reader = new FileReader();
   reader.readAsDataURL(file);
   reader.onload = function () {
     console.log(reader.result);
   };
   reader.onerror = function (error) {
     console.log('Error: ', error);
   };
var base64vr = reader.result.split("base64,").pop();
	return base64vr;
}

	function sendToSf(){
			var sub = document.getElementById("subject").value;
            var  fileBody = document.querySelector('input[type=file]').files[0];
            var base64 = getBase64(fileBody);
			var data = JSON.stringify({
			    "Subject": sub,
  				"Description": "i am stuck",
  				"Origin": "Web",
  				"ContentLocation": "S",
  				"PathOnClient": "File_name",
  				"Title": "file_name_in_salesforce",
  				"VersionData": base64
			});
            
            var xhr = new XMLHttpRequest();
            xhr.addEventListener("readystatechange", function () {
              if (this.readyState === 4) {
                console.log(this.responseText);
              }
            });

            xhr.open("POST", "https://customercare-mastercard--Dev.cs21.my.salesforce.com/services/apexrest/createCaseWithAttachment/v1/");
            xhr.setRequestHeader("authorization", "OAuth "+accessTok);
            xhr.setRequestHeader("content-type", "application/json");
            xhr.send(data);
			
			
            
			
	}
</script>
</head>
<body>	
	<div class="container">
	  <form >   
	  <input type="button" value="Login To Salesforce" onclick="window.location='https://test.salesforce.com/services/oauth2/authorize?response_type=code&client_id=3MVG9Y6d_Btp4xp6IO8doiQawYj4FhisKiBtMF6fhsDCkAdeMTfSy_h24E0jiJue3KqlhpVD5esusvOcrWbPv&redirect_uri=https://shaileshjyotigit.github.io/testNewSfRestTest/SalesforceJQueryRESTCalls.html';">
	    <label for="subject">Subject</label>
	    <textarea id="subject" name="subject" placeholder="Write something.." style="height:200px"></textarea>
	  <input id="inputFileToLoad" type="file"  />
	    <input type="button" value="Submit" onclick="sendToSf()" >
	  </form>
	</div>
</body>
</html>  
